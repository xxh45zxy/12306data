# 12306账户订单和车票数据的永久保存

2025年10月1日起，除特殊情况外，中国国家铁路集团有限公司将**全面取消铁路车票（纸质报销凭证）**，转而**使用电子发票（铁路电子客票）**。此后，旅客的铁路行程便很难永久保存，也失去了一个重要的情感载体。

因此，自2025年3月起，作者就开始努力开发本脚本，用于**永久保存12306账户内的订单和车票数据**。

**本脚本的数据是永久保存的，一旦保存便不受12306网站仅保留30天数据的限制。**

**本脚本目前仅支持Windows操作系统。**

## 脚本支持保存的数据范围

如下表所列，12306账户中展示的各种订单和车票数据，本脚本均可**永久**保存。

| 文件名称 | 主要内容 | 主要范围 |
|-------|-------|-------|
| `railwaypsr.csv` | 本人车票 | 本12306账户本人的车票数据，但不包括银通卡（非预约）、e卡通（非预约）等特殊票种 |
| `railwaytrip.csv` | 火车票订单 | 使用本12306账户下单并支付的“火车票订单”，但不包括他人为你购买的车票和银通卡、e卡通、计次定期票等特殊票种 |
| `railwaytripdetail.csv` | 火车票订单-订单跟踪 | 使用本12306账户下单并支付的“火车票订单”的“订单跟踪”数据，例如进出站时间、检票时间等，但不包括他人为你购买的车票和银通卡、e卡通、计次定期票等特殊票种 |
| `railwayalternate.csv` | 候补订单 | 使用本12306账户下单并支付的“候补订单”，但不包括他人为你候补的车票 |
| `railwaymemtrade.csv` | “铁路畅行”常旅客会员积分明细 | 本12306账户对应的“铁路畅行”常旅客会员已产生的积分明细数据 |
| `railwaymemtradedetail.csv` | “铁路畅行”常旅客会员积分明细详情 | 本12306账户对应的“铁路畅行”常旅客会员已产生的积分明细详细数据 |
| `railwayinvoice.csv` | 电子发票 | 本12306账户本人的铁路电子发票数据，但不包括跨境车票、计次定期票、2025年10月1日前乘车的银通卡、e卡通等特殊票种 |
| `railwaycomminvoice.csv` | 计次定期票电子发票 | 本12306账户本人的计次定期票电子发票数据，激活日期应在2025年10月1日及以后 |
| `railwaynotice.csv` | 行程信息提示 | 上述“本人车票”和“火车票订单”中各车票的行程信息提示数据，但不包括银通卡（非预约）、e卡通（非预约）等特殊票种 |
| `railwaycommorder.csv` | 计次定期票订单 | 本12306账户本人的和使用本12306账户下单并支付的“计次定期票订单” |
| `railwaycommreserve.csv` | 计次定期票预约记录 | 本12306账户本人的计次定期票预约、乘车记录，以及为他人预约的计次定期票预约记录 |

由于铁路系统的特殊性，下列乘车凭证数据，本脚本**无法**获取和保存：

- 线下发售的非实名制车票（上海金山线等）
- 银通卡（非预约）车票
- e卡通（非预约）车票
- 特殊证件车票
- 应急售票车票
- 未利用铁路客票发售和预定系统（TRS）发售的车票，例如：
  - 地方铁路自研售票系统发售的车票（刷交通卡乘车、广东城际单程票、西安地铁西户线等）
  - “广深城际通”小程序扫码乘车车票
  - 非电子化列车补票
  - 区段票
  - 代用票
  - 定额客票
  - 未办理签证的铁路乘车证
  - 特种乘车证
  - 中国铁路免费乘车证
  - 铁路合作组织规定的客票、补加费收据、卧铺票、公用乘车证、一次性免费乘车证等乘车凭证
  - 外国铁路发售的车票（老挝铁路发售的中老铁路跨境车票等）
- 其他特殊乘车凭证

## 脚本使用方法

### 安装浏览器

本脚本目前支持Edge和Chrome浏览器。**如果你使用Windows 10及以上版本操作系统，你可以忽略这一步，**因为Windows 10及以上已经预装了Edge浏览器。

如果你使用较低版本的Windows操作系统，请自行安装Edge或Chrome浏览器，普通版本即可。请注意，**本脚本并未在较低版本的Windows操作系统上测试，可能会出现意料之外的错误**。

### 安装Python

访问（64位）`https://www.python.org/ftp/python/3.11.0/python-3.11.0-amd64.exe`或（32位）`https://www.python.org/ftp/python/3.11.0/python-3.11.0.exe`，下载安装包。

运行下载的程序，安装`Python 3.11.0`。**注意勾选`Add Python to PATH`。**

作者认为其他Python版本也可以正常运行本脚本，**但没有进行专门测试**。

### 安装依赖

按`Win`+`R`，输入`cmd`，随后输入以下代码安装必要的依赖，回车，等待安装完成。

```bash
pip install pandas selenium webdriver-manager webdrivermanager_cn
```

### 下载并解压脚本

点击页面绿色`Code`，点击`Download ZIP`，下载后解压。

### 使用脚本

右击`railway.py`，选择`Edit with IDLE`。打开脚本后按`F5`开始运行。

#### 选择浏览器

如果你希望使用Chrome浏览器，直接回车。如果你希望使用Edge浏览器，输入`1`，回车。其他浏览器暂不支持。

#### 登录和身份核验

等待浏览器窗口自动弹出。**如果是第一次使用本脚本，这一步可能较慢。**

窗口弹出后，打开手机版12306APP，扫码登录，再扫码进行身份核验。

两次扫码完成后，回到脚本界面，回车。

#### 等候脚本运行完成

此时脚本会不断弹出提示，等待即可。

如果脚本提示选择，按实际情况输入字符选择即可，详见注意事项。

脚本提示`Press Enter to continue...`时，按回车关闭脚本。

#### 查看结果

回到脚本所在目录，查看以`.csv`文件保存的结果。这些文件可在Excel或WPS中打开。每次运行时，这些文件会被自动更新。

### 注意事项

- **本脚本会自动更新`chromedriver`/`edgedriver`。如果你有其他脚本依赖特定版本的`chromedriver`/`edgedriver`运行，建议自行修改代码。**

- 由于12306仅保留近30天数据，建议**至少每25天运行一次本脚本**。

- 脚本运行过程中，可能出现需要选择的情况。常见情况是`检查到E123456789订单重复，最新操作时间分别是2025-09-30 10:00:00，2025-10-01 10:00:00。`
  
  一般这种情况发生在改签订单中。如果两个操作时间相差不超过1个月，可以直接回车，仅保留最新数据。

  如果两个操作时间相差超过一个月，请输入`0`，回车，保留所有数据，并请报告作者。
- 如果发现数据不全，可以多运行几次。
- 如果程序经常报错，可能是触发了12306风控，可以过几天再运行。

## 问题报告&功能建议

- 发送邮件到`xxh45zxy@126.com`。发送时最好附上错误截图。
- 在本项目下`New Issue`。不过，如果问题数据涉及隐私，作者建议发送邮件。

## 声明

## **本脚本仅供学习交流使用，严禁用于各种非法用途，严禁用于违反铁路运输企业规定的用途，特别是禁止用于购买车票。作者不对非法使用本脚本产生的后果承担任何责任！**